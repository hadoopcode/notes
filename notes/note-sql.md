1. 找出所有科目成绩都大于某一学科平均成绩的学生(uid,subject_id,score)
2. 统计出每个用户的累积访问次数

|userId|visitDate|visitCount|
|------|---------|----------|
|u01   |2017/1/21|5         |
|u02   |2017/1/23|6         |
|u03   |2017/1/22|7         |
|u04   |2017/1/20|3         |
|u01   |2017/1/23|6         |
|u01   |2017/2/21|8         |
|u02   |2017/1/23|6         |
|u01   |2017/2/22|4         |

|userId|月份	   |小计	|累积|
|------|-------|----|---|
|u01   |2017-01|11	|11 |
|u01   |2017-02|12	|23 |
|u02   |2017-01|12	|12 |
|u03   |2017-01|8	|8  |
|u04   |2017-01|3	|3  |

3.有50W个京东店铺，每个顾客访客访问任何一个店铺的任何一个商品时都会产生一条访问日志，访问日志存储的表名为Visit，访客的用户id为user_id，被访问的店铺名称为shop，请统计： \
1）每个店铺的UV（访客数） \
2）每个店铺访问次数top3的访客信息。输出店铺名称、访客id、访问次数

|userId| shop|
|------|-----|
|u1    |a    |
|u2    |b    |
|u1    |b    |
|u1    |a    |
|u3    |c    |
|u4    |b    |
|u1    |a    |
|u2    |c    |
|u5    |b    |
|u4    |b    |
|u6    |c    |
|u2    |c    |
|u1    |b    |
|u2    |a    |
|u2    |a    |
|u3    |a    |
|u5    |a    |
|u5    |a    |
|u5    |a    |


4.已知一个表STG.ORDER，有如下字段:Date，Order_id，User_id，amount。

|dt        |order_id|user_id   |amount|
|----------|--------|-------   |------|
|2017-01-01|10029028|1000003251|33.57 |

1）给出 2017年每个月的订单数、用户数、总成交金额。\
2）给出2017年11月的新客数(指在11月才有第一笔订单)

5.有日志如下，请写出代码求得**所有用户和活跃用户的总数及平均年龄**。（活跃用户指连续两天都有访问记录的用户）日期 用户 年龄

|dt        |user_id|age|
|----------|-------|---|
|2019-02-11|test_1|23|
|2019-02-11|test_2|19|
|2019-02-11|test_3|39|
|2019-02-11|test_1|23|
|2019-02-11|test_3|39|
|2019-02-11|test_1|23|
|2019-02-12|test_2|19|
|2019-02-13|test_1|23|
|2019-02-15|test_2|19|
|2019-02-16|test_2|19|

6.所有用户中在今年10月份第一次购买商品的金额。

|user_id|money|payment_time(购买时间)|order_id|
|-------|-----|--------------------|--------|

7.求11月9号下午14点（14-15点）,访问api/user/login接口的top10的ip地址

|time                |interface         |ip           |
|--------------------|------------------|-------------|
|2016-11-09 14:22:05 |/api/user/login	|110.23.5.33  |
|2016-11-09 11:23:10 |/api/user/detail	|57.3.2.16    |
|2016-11-09 14:59:40 |/api/user/login	|200.6.5.166  |
|2016-11-09 14:22:05 |/api/user/login	|110.23.5.34  |
|2016-11-09 14:22:05 |/api/user/login	|110.23.5.34  |
|2016-11-09 14:22:05 |/api/user/login	|110.23.5.34  |
|2016-11-09 11:23:10 |/api/user/detail	|57.3.2.16    |
|2016-11-09 23:59:40 |/api/user/login	|200.6.5.166  |
|2016-11-09 14:22:05 |/api/user/login	|110.23.5.34  |
|2016-11-09 11:23:10 |/api/user/detail	|57.3.2.16    |
|2016-11-09 23:59:40 |/api/user/login	|200.6.5.166  |
|2016-11-09 14:22:05 |/api/user/login	|110.23.5.35  |
|2016-11-09 14:23:10 |/api/user/detail	|57.3.2.16    |
|2016-11-09 23:59:40 |/api/user/login	|200.6.5.166  |
|2016-11-09 14:59:40 |/api/user/login	|200.6.5.166  |
|2016-11-09 14:59:40 |/api/user/login	|200.6.5.166  |

8.有一个账号表如下，请写出SQL语句，查询各自区组的money排名前十的账号（分组取前10）

|dist_id(区组id)|account(账号)|gold(金币)|
|--------------|------------|---------|

9.分组查出销售表中所有会员购买金额，同时分组查出退货表中所有会员的退货金额，把会员id相同的购买金额-退款金额得到的结果更新到表会员表中对应会员的积分字段（credits）
- 有三张表分别为会员表（member）销售表（sale）退货表（regoods）
(1)会员表有字段memberid（会员id，主键）credits（积分）\
(2)销售表有字段memberid（会员id，外键）购买金额（MNAccount）\
(3)退货表中有字段memberid（会员id，外键）退货金额（RMNAccount）
- 业务说明 \
(1)销售表中的销售记录可以是会员购买，也可以是非会员购买。（即销售表中的memberid可以为空）\
(2)销售表中的一个会员可以有多条购买记录 \
(3)退货表中的退货记录可以是会员，也可是非会员 \
(4)一个会员可以有一条或多条退货记录 

10.用一条SQL语句查询出每门课都大于80分的学生姓名

|name|class_name|score|
|----|----------|-----|
|张三 |语文      | 81|
|张三 |数学      | 75|
|李四 |语文      | 76|
|李四 |数学      | 90|
|王五 |语文      | 81|
|王五 |数学      | 100|
|王五 |英语      | 90|

11.删除除了自动编号不同, 其他都相同的学生冗余信息

|auto_id|stu_id|name|class_id|class_name|score|
|-------|------|----|--------|----------|-----|
|1     |2005001| 张三|   0001|   数学|   69|
|2     |2005002| 李四|   0001|   数学|   89|
|3     |2005001| 张三|   0001|   数学|   69|

12.一个叫team的表，里面只有一个字段name,一共有4条纪录，分别是a,b,c,d,对应四个球队，现在四个球队进行比赛，用一条sql语句显示所有可能的比赛组合
13.表1变表2

|year|month|amount|      
|----|-----|------|      
|1991|   1 |   1.1|
|1991|   2 |   1.2|
|1991|   3 |   1.3|
|1991|   4 |   1.4|
|1992|   1 |   2.1|
|1992|   2 |   2.2|
|1992|   3 |   2.3|
|1992|   4 |   2.4|

|year|m1 |m2 |m3 |m4 |
|----|---|---|---|---|
|1991|1.1|1.2|1.3|1.4|
|1992|2.1|2.2|2.3|2.4| 

14.表3变表4(及格分数为60)

|course_id|course_name|score|
|---------|-----------|-----|
|1        |java       |70   |
|2        |oracle     |90   |
|3        |xml        |40   |
|4        |jsp        |30   |
|5        |servlet    |80   |

|course_id|course_name|score|mark|
|---------|-----------|-----|----|
|1        |java       |70   |pass|
|2        |oracle     |90   |pass|
|3        |xml        |40   |fail|
|4        |jsp        |30   |fail|
|5        |servlet    |80   |pass|

15.给出所有购入商品为两种或两种以上的购物人记录

|购物人|商品名称|数量|
|-----|------|----|
|A    |甲    |   2|
|B    |乙    |   4|
|C    |丙    |   1|
|A    |丁    |   2|
|B    |丙    |   5|

16.表5变表6

|date|result|
|----|------|
|2005-05-09|win|
|2005-05-09|lose| 
|2005-05-09|lose| 
|2005-05-09|lose| 
|2005-05-10|win |
|2005-05-10|lose| 
|2005-05-10|lose| 

|   date   | win |lose|
|----------|-----|----|
|2005-05-09|  2  | 2  |
|2005-05-10|  1  | 2  |

17.有一个订单表order。已知字段有：order_id(订单ID), user_id(用户ID),amount(金额), pay_datetime(付费时间),channel_id(渠道ID),dt(分区字段)

- 在Hive中创建这个表。
- 查询dt=‘2018-09-01‘里每个渠道的订单数，下单人数（去重），总金额。
- 查询dt=‘2018-09-01‘里每个渠道的金额最大3笔订单。
- 有一天发现订单数据重复，请分析原因

|order_id|item_id|create_time|amount|
|--------|-------|-------|------|

|item_id|item_name|category|
|-------|-------|------|

|item_id|item_name|category_1|category_2|
|--------|-------|-------|------|

- 最近一个月，销售数量最多的10个商品
- 最近一个月，每个种类里销售数量最多的10个商品(一个订单对应一个商品 一个商品对应一个品类)
- 计算平台的每一个用户发过多少日记、获得多少点赞数

18.处理产品版本号

|主版本号|子版本号|阶段版本号|
|-------|------|--------|

- 需求A:找出T1表中最大的版本号
- 需求B：计算出如下格式的所有版本号排序，要求对于相同的版本号，顺序号并列

19.求中位数  
20.有张“钻井平台采油量表”，有两个字段，A年月日时分秒，B累计采油量。  
1）求第四次下钻的采油量  
2）求平均每次采油量  
21.有一个分区表，表名T，字段qq，age，按天分区，让写出创建表的语句  
22.分区表，求20200221这个分区中，年龄第N大的qq号列表，找出所有互相关注的qq对   

|qqa|qqb|
|---|---|
|12|56|  
|12|78|  
|34|56|  
|34|12|

23.计算开始时间和结束时间的差值的中位数，多种方法：

|req_id|event|timestamp|
|-------|------|--------|
|1|start|1400xxxxx|
|1|end  |1400xxxxx|

24. 查询出用户连续三天登录的用户

|user_id|login_date|
|-------|----------|
|   1   |20200325  |
  
25.全量用户登员日志表t_login_all，字段信息ftime（登录日期）、openid（登录帐号）新增用户登录日志表t_login_new，字段信息ftime（登录日期）、openid（登录帐号）  
求每天新增用户次日、7天、30天留存率。（说明：7天留存是指当天有登录且第7天还登录的用户）  
26.消息流水表t_chat all，字段信息：  
Ftime（日期）、send_user id（发消息用户id）、receive.user id（接收消息用户id）、chat id（消息id）、send.time（发消息时间）  
用户登录流水日志表t_login_all，字段信息：  
Ftime（日期）、user_id（用户id）、login_id（登录id）、login_loc（登录区服）、login_time（登录时间）  
求：每天有收发消息用户最近登录时间、登录区服，输出ftime，user_id，login_loc，login_time
27.统计每个地区的温度最高的对应的年份。

|area| year| temperature|
|----|-----|------------|

28.如下表  
![Image text](https://raw.githubusercontent.com/hadoopcode/notes/master/img/sql-table1.png)  
1）.写出用户表 tb_cuid_1d的 20200401 的次日、次7日留存的具体HQL ：一条sql统计出以下指标 （4.1号uv，4.1号在4.2号的留存uv，4.1号在4.8号的留存uv）(一条sql写完)  
2）.统计当天不同平台、版本下的uv、pv  
3）.解析ext中所有的"type"( lateral view explode)  
29.表t_a (uid,os,day) 和表t_b(uid,os,day)  
1）15号在t_a 但是不在t_b的用户  
2）t_a中最近30内，所有用户末次活跃日期  
3）t_a中最近30内，所有用户末次活跃日期和倒数第二次的差值  
31.把每科最高分前三名统计出来 --成绩表Score（student_name,student_no,subject_no,score）  
32.找出单科成绩高于该科平均成绩的同学名单（无论该学生有多少科，只要有一科满足即可） --成绩表Score（student_name,student_no,subject_no,score）  
33.一个表 test(name,price),构建一个新表,将name相同的,price所有价格合并到一个字段里面  
34.如何将题33中price合并后的prices 字段再拆分为多条记录？  

35.见下图
![Image text](https://raw.githubusercontent.com/hadoopcode/notes/master/img/img1.jpg) 


   		
   			














